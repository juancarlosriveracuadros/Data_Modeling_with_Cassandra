{
	"name": "DF_CORE_MART",
	"properties": {
		"folder": {
			"name": "CORE_MART"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "SRC_AZRSQL_ALL_LAYER_STRUCTURE",
						"type": "DatasetReference"
					},
					"name": "SourceCoreSales"
				},
				{
					"dataset": {
						"referenceName": "SRC_AZRSQL_ALL_LAYER_STRUCTURE",
						"type": "DatasetReference"
					},
					"name": "SourceCoreKunde"
				},
				{
					"dataset": {
						"referenceName": "SRC_AZRSQL_ALL_LAYER_STRUCTURE",
						"type": "DatasetReference"
					},
					"name": "SourceCoreDate"
				},
				{
					"dataset": {
						"referenceName": "SRC_AZRSQL_ALL_LAYER_STRUCTURE",
						"type": "DatasetReference"
					},
					"name": "SourceCoreMaterial"
				},
				{
					"dataset": {
						"referenceName": "SRC_AZRSQL_ALL_LAYER_STRUCTURE",
						"type": "DatasetReference"
					},
					"name": "SourceCoreOrga"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "TRG_AZRLAKE_MART_DASHBOARD_SALES",
						"type": "DatasetReference"
					},
					"name": "sinkMartMonth"
				}
			],
			"transformations": [
				{
					"name": "JoinKunde"
				},
				{
					"name": "JoinDate"
				},
				{
					"name": "JoinMaterial"
				},
				{
					"name": "JoinOrga"
				},
				{
					"name": "TimeSort"
				},
				{
					"name": "SelectMart"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "onlyCurrentFlagCoreSales"
				},
				{
					"name": "onlyCurrentFlagCoreKunde"
				},
				{
					"name": "onlyCurrentFlagCoreMaterial"
				},
				{
					"name": "onlyCurrentFlagOrg"
				}
			],
			"script": "source(output(\n\t\tCSAL_FACT_SALES_SK as string,\n\t\tDIM_KUNDE_FK as string,\n\t\tDIM_ORGA_FK as string,\n\t\tDIM_ZEIT_FK as string,\n\t\tDIM_MATERIAL_FK as string,\n\t\tDIM_AUFTRAG_FK as string,\n\t\tCSAL_MANDT as string,\n\t\tCSAL_VBELN as string,\n\t\tCSAL_MATNR as string,\n\t\tCSAL_AUFNR as string,\n\t\tCSAL_KUNNR as string,\n\t\tCSAL_AWAHR as string,\n\t\tCSAL_BNAME as string,\n\t\tCSAL_VKORG as string,\n\t\tCSAL_VTWEG as string,\n\t\tCSAL_POSNR as string,\n\t\tCSAL_NETPR as string,\n\t\tCSAL_WAERK as string,\n\t\tCSAL_KWMENG as string,\n\t\tCSAL_UMSATZ as string,\n\t\tCSAL_BSTDK as string,\n\t\tCSAL_HASHKEY_BK as string,\n\t\tCSAL_HASHKEY_DATA as string,\n\t\tCSAL_CREATED_ON as string,\n\t\tCSAL_SOURCE as string,\n\t\tCSAL_VALID_TO as string,\n\t\tCSAL_CURRENT_FLAG as string,\n\t\tCSAL_DML_STRAT as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM CORE.FACT_SALES',\n\tformat: 'query') ~> SourceCoreSales\nsource(output(\n\t\tCKUN_DIM_KUNDE_SK as string,\n\t\tCKUN_MANDT as string,\n\t\tCKUN_KUNNR as string,\n\t\tCKUN_ANRED as string,\n\t\tCKUN_ADRNR as string,\n\t\tCKUN_NAME1 as string,\n\t\tCKUN_MCOD1 as string,\n\t\tCKUN_MCOD3 as string,\n\t\tCKUN_TELF1 as string,\n\t\tCKUN_LAND1 as string,\n\t\tCKUN_STRAS as string,\n\t\tCKUN_PSTLZ as string,\n\t\tCKUN_ORT01 as string,\n\t\tCKUN_ORT02 as string,\n\t\tCKUN_REGIO as string,\n\t\tCKUN_HASHKEY_BK as string,\n\t\tCKUN_HASHKEY_DATA as string,\n\t\tCKUN_CREATED_ON as string,\n\t\tCKUN_SOURCE as string,\n\t\tCKUN_VALID_FROM as string,\n\t\tCKUN_VALID_TO as string,\n\t\tCKUN_CURRENT_FLAG as string,\n\t\tCKUN_DML_STRAT as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM CORE.DIM_KUNDE',\n\tformat: 'query') ~> SourceCoreKunde\nsource(output(\n\t\tDateKey as integer,\n\t\tDate as date,\n\t\tDay as integer,\n\t\tDaySuffix as string,\n\t\tWeekday as integer,\n\t\tWeekDayName as string,\n\t\tWeekDayName_Short as string,\n\t\tWeekDayName_FirstLetter as string,\n\t\tDOWInMonth as integer,\n\t\tDayOfYear as short,\n\t\tWeekOfMonth as integer,\n\t\tWeekOfYear as integer,\n\t\tMonth as integer,\n\t\tMonthName as string,\n\t\tMonthName_Short as string,\n\t\tMonthName_FirstLetter as string,\n\t\tQuarter as integer,\n\t\tQuarterName as string,\n\t\tYear as integer,\n\t\tMMYYYY as string,\n\t\tMonthYear as string,\n\t\tIsWeekend as boolean,\n\t\tIsHoliday as boolean,\n\t\tHolidayName as string,\n\t\tSpecialDays as string,\n\t\tFinancialYear as integer,\n\t\tFinancialQuater as integer,\n\t\tFinancialMonth as integer,\n\t\tFirstDateofYear as date,\n\t\tLastDateofYear as date,\n\t\tFirstDateofQuater as date,\n\t\tLastDateofQuater as date,\n\t\tFirstDateofMonth as date,\n\t\tLastDateofMonth as date,\n\t\tFirstDateofWeek as date,\n\t\tLastDateofWeek as date,\n\t\tCurrentYear as short,\n\t\tCurrentQuater as short,\n\t\tCurrentMonth as short,\n\t\tCurrentWeek as short,\n\t\tCurrentDay as short\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM CORE.DIM_DATE',\n\tformat: 'query') ~> SourceCoreDate\nsource(output(\n\t\tCMAT_DIM_MATERIAL_SK as string,\n\t\tCMAT_MANDT as string,\n\t\tCMAT_MATNR as string,\n\t\tCMAT_MTART as string,\n\t\tCMAT_SPRAS as string,\n\t\tCMAT_MTBEZ as string,\n\t\tCMAT_MTREF as string,\n\t\tCMAT_MAKTX as string,\n\t\tCMAT_HASHKEY_BK as string,\n\t\tCMAT_HASHKEY_DATA as string,\n\t\tCMAT_CREATED_ON as string,\n\t\tCMAT_SOURCE as string,\n\t\tCMAT_VALID_FROM as string,\n\t\tCMAT_VALID_TO as string,\n\t\tCMAT_CURRENT_FLAG as string,\n\t\tCMAT_DML_STRAT as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM CORE.DIM_MATERIAL',\n\tformat: 'query') ~> SourceCoreMaterial\nsource(output(\n\t\tCORG_DIM_ORGA_SK as string,\n\t\tCORG_MANDT as string,\n\t\tCORG_VKORG as string,\n\t\tCORG_VTWEG as string,\n\t\tCORG_KOKRS as string,\n\t\tCORG_BUKRS as string,\n\t\tCORG_SPRAS as string,\n\t\tCORG_BUTXT as string,\n\t\tCORG_ORT01 as string,\n\t\tCORG_LAND1 as string,\n\t\tCORG_VKORG_VTEXT as string,\n\t\tCORG_VTWEG_VTEXT as string,\n\t\tCORG_KOKRS_BEZEI as string,\n\t\tCORG_HASHKEY_BK as string,\n\t\tCORG_HASHKEY_DATA as string,\n\t\tCORG_CREATED_ON as string,\n\t\tCORG_SOURCE as string,\n\t\tCORG_VALID_FROM as string,\n\t\tCORG_VALID_TO as string,\n\t\tCORG_CURRENT_FLAG as string,\n\t\tCORG_DML_STRAT as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM CORE.DIM_ORGA',\n\tformat: 'query') ~> SourceCoreOrga\nonlyCurrentFlagCoreSales, onlyCurrentFlagCoreKunde join(DIM_KUNDE_FK == CKUN_DIM_KUNDE_SK,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinKunde\nJoinKunde, SourceCoreDate join(toInteger(DIM_ZEIT_FK) == DateKey,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinDate\nJoinDate, onlyCurrentFlagCoreMaterial join(DIM_MATERIAL_FK == CMAT_DIM_MATERIAL_SK,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinMaterial\nJoinMaterial, onlyCurrentFlagOrg join(DIM_ORGA_FK == CORG_DIM_ORGA_SK,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinOrga\nJoinOrga sort(asc(DIM_ZEIT_FK, false)) ~> TimeSort\nTimeSort select(mapColumn(\n\t\tMANDT = CSAL_MANDT,\n\t\tVBELN = CSAL_VBELN,\n\t\tPOSNR = CSAL_POSNR,\n\t\tKUNNR = CSAL_KUNNR,\n\t\tNAME1 = CKUN_NAME1,\n\t\tAUFNR = CSAL_AUFNR,\n\t\tABSATZ = CSAL_KWMENG,\n\t\tUMSATZ = CSAL_UMSATZ,\n\t\tCORG_BUTXT,\n\t\tVKORG = CSAL_VKORG,\n\t\tVKORG_VTEXT = CORG_VKORG_VTEXT,\n\t\tVTWEG = CSAL_VTWEG,\n\t\tVTWEG_VTEXT = CORG_VTWEG_VTEXT,\n\t\tMATNR = CSAL_MATNR,\n\t\tMaterial_MAKTX = CMAT_MAKTX,\n\t\tMaterial_MATNR = CSAL_MATNR,\n\t\tMaterial_MTBEZ = CMAT_MTBEZ,\n\t\tDateKey,\n\t\tDate,\n\t\tQuarterName,\n\t\tQuarter,\n\t\tMonthYear,\n\t\tYear\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectMart\nSelectMart derive(MANDT = toInteger(MANDT),\n\t\tABSATZ = toInteger(ABSATZ),\n\t\tUMSATZ = toDouble(UMSATZ),\n\t\tDate = toDate(toTimestamp(Date)),\n\t\tDateKey = toInteger(DateKey),\n\t\tYear = toInteger(Year)) ~> DerivedColumn1\nSourceCoreSales filter(CSAL_CURRENT_FLAG == 'Y') ~> onlyCurrentFlagCoreSales\nSourceCoreKunde filter(CKUN_CURRENT_FLAG == 'Y') ~> onlyCurrentFlagCoreKunde\nSourceCoreMaterial filter(CMAT_CURRENT_FLAG == 'Y') ~> onlyCurrentFlagCoreMaterial\nSourceCoreOrga filter(CORG_CURRENT_FLAG == 'Y') ~> onlyCurrentFlagOrg\nDerivedColumn1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\trecreate:true,\n\tformat: 'table',\n\tmapColumn(\n\t\tMANDT,\n\t\tVBELN,\n\t\tPOSNR,\n\t\tKUNNR,\n\t\tNAME1,\n\t\tAUFNR,\n\t\tABSATZ,\n\t\tUMSATZ,\n\t\tCORG_BUTXT,\n\t\tVKORG,\n\t\tVKORG_VTEXT,\n\t\tVTWEG,\n\t\tVTWEG_VTEXT,\n\t\tMATNR,\n\t\tMaterial_MAKTX,\n\t\tMaterial_MTBEZ,\n\t\tDateKey,\n\t\tDate,\n\t\tQuarterName,\n\t\tQuarter,\n\t\tMonthYear,\n\t\tYear\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sinkMartMonth"
		}
	}
}