{
	"name": "DF_CLEANSE_KUNDE",
	"properties": {
		"folder": {
			"name": "STAGE_CLEANSE"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "SRC_AZRSQL_ALL_LAYER_STRUCTURE",
						"type": "DatasetReference"
					},
					"name": "sourceStageKNA1"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "TRG_AZRSQL_CLEANSE_KUNDE",
						"type": "DatasetReference"
					},
					"name": "stageCleanseKunde"
				}
			],
			"transformations": [
				{
					"name": "selectCol"
				},
				{
					"name": "changeDatatype"
				},
				{
					"name": "createHash"
				},
				{
					"name": "SelectColumnOrder"
				},
				{
					"name": "distictRows"
				}
			],
			"script": "source(output(\n\t\tMANDT as string,\n\t\tKUNNR as string,\n\t\tLAND1 as string,\n\t\tNAME1 as string,\n\t\tNAME2 as string,\n\t\tORT01 as string,\n\t\tPSTLZ as string,\n\t\tREGIO as string,\n\t\tSORTL as string,\n\t\tSTRAS as string,\n\t\tTELF1 as string,\n\t\tTELFX as string,\n\t\tXCPDK as string,\n\t\tADRNR as string,\n\t\tMCOD1 as string,\n\t\tMCOD2 as string,\n\t\tMCOD3 as string,\n\t\tANRED as string,\n\t\tAUFSD as string,\n\t\tBAHNE as string,\n\t\tBAHNS as string,\n\t\tBBBNR as string,\n\t\tBBSNR as string,\n\t\tBEGRU as string,\n\t\tBRSCH as string,\n\t\tBUBKZ as string,\n\t\tDATLT as string,\n\t\tERDAT as string,\n\t\tERNAM as string,\n\t\tEXABL as string,\n\t\tFAKSD as string,\n\t\tFISKN as string,\n\t\tKNAZK as string,\n\t\tKNRZA as string,\n\t\tKONZS as string,\n\t\tKTOKD as string,\n\t\tKUKLA as string,\n\t\tLIFNR as string,\n\t\tLIFSD as string,\n\t\tLOCCO as string,\n\t\tLOEVM as string,\n\t\tNAME3 as string,\n\t\tNAME4 as string,\n\t\tNIELS as string,\n\t\tORT02 as string,\n\t\tPFACH as string,\n\t\tPSTL2 as string,\n\t\tCOUNC as string,\n\t\tCITYC as string,\n\t\tRPMKR as string,\n\t\tSPERR as string,\n\t\tSPRAS as string,\n\t\tSTCD1 as string,\n\t\tSTCD2 as string,\n\t\tSTKZA as string,\n\t\tSTKZU as string,\n\t\tTELBX as string,\n\t\tTELF2 as string,\n\t\tTELTX as string,\n\t\tTELX1 as string,\n\t\tLZONE as string,\n\t\tXZEMP as string,\n\t\tVBUND as string,\n\t\tSTCEG as string,\n\t\tDEAR1 as string,\n\t\tDEAR2 as string,\n\t\tDEAR3 as string,\n\t\tDEAR4 as string,\n\t\tDEAR5 as string,\n\t\tGFORM as string,\n\t\tBRAN1 as string,\n\t\tBRAN2 as string,\n\t\tBRAN3 as string,\n\t\tBRAN4 as string,\n\t\tBRAN5 as string,\n\t\tEKONT as string,\n\t\tUMSAT as decimal(38,18),\n\t\tUMJAH as string,\n\t\tUWAER as string,\n\t\tJMZAH as string,\n\t\tJMJAH as string,\n\t\tKATR1 as string,\n\t\tKATR2 as string,\n\t\tKATR3 as string,\n\t\tKATR4 as string,\n\t\tKATR5 as string,\n\t\tKATR6 as string,\n\t\tKATR7 as string,\n\t\tKATR8 as string,\n\t\tKATR9 as string,\n\t\tKATR10 as string,\n\t\tSTKZN as string,\n\t\tUMSA1 as decimal(38,18),\n\t\tTXJCD as string,\n\t\tPERIV as string,\n\t\tABRVW as string,\n\t\tINSPBYDEBI as string,\n\t\tINSPATDEBI as string,\n\t\tKTOCD as string,\n\t\tPFORT as string,\n\t\tWERKS as string,\n\t\tDTAMS as string,\n\t\tDTAWS as string,\n\t\tDUEFL as string,\n\t\tHZUOR as string,\n\t\tSPERZ as string,\n\t\tETIKG as string,\n\t\tCIVVE as string,\n\t\tMILVE as string,\n\t\tKDKG1 as string,\n\t\tKDKG2 as string,\n\t\tKDKG3 as string,\n\t\tKDKG4 as string,\n\t\tKDKG5 as string,\n\t\tXKNZA as string,\n\t\tFITYP as string,\n\t\tSTCDT as string,\n\t\tSTCD3 as string,\n\t\tSTCD4 as string,\n\t\tSTCD5 as string,\n\t\tXICMS as string,\n\t\tXXIPI as string,\n\t\tXSUBT as string,\n\t\tCFOPC as string,\n\t\tTXLW1 as string,\n\t\tTXLW2 as string,\n\t\tCCC01 as string,\n\t\tCCC02 as string,\n\t\tCCC03 as string,\n\t\tCCC04 as string,\n\t\tCASSD as string,\n\t\tKNURL as string,\n\t\tJ_1KFREPRE as string,\n\t\tJ_1KFTBUS as string,\n\t\tJ_1KFTIND as string,\n\t\tCONFS as string,\n\t\tUPDAT as string,\n\t\tUPTIM as string,\n\t\tNODEL as string,\n\t\tDEAR6 as string,\n\t\tCVP_XBLCK as string,\n\t\tSUFRAMA as string,\n\t\tRG as string,\n\t\tEXP as string,\n\t\tUF as string,\n\t\tRGDATE as string,\n\t\tRIC as string,\n\t\tRNE as string,\n\t\tRNEDATE as string,\n\t\tCNAE as string,\n\t\tLEGALNAT as string,\n\t\tCRTN as string,\n\t\tICMSTAXPAY as string,\n\t\tINDTYP as string,\n\t\tTDT as string,\n\t\tCOMSIZE as string,\n\t\tDECREGPC as string,\n\t\tKNA1_EEW_CUST as string,\n\t\t{/VSO/R_PALHGT} as decimal(38,18),\n\t\t{/VSO/R_PAL_UL} as string,\n\t\t{/VSO/R_PK_MAT} as string,\n\t\t{/VSO/R_MATPAL} as string,\n\t\t{/VSO/R_I_NO_LYR} as string,\n\t\t{/VSO/R_ONE_MAT} as string,\n\t\t{/VSO/R_ONE_SORT} as string,\n\t\t{/VSO/R_ULD_SIDE} as string,\n\t\t{/VSO/R_LOAD_PREF} as string,\n\t\t{/VSO/R_DPOINT} as string,\n\t\tALC as string,\n\t\tPMT_OFFICE as string,\n\t\tFEE_SCHEDULE as string,\n\t\tDUNS as string,\n\t\tDUNS4 as string,\n\t\tPSOFG as string,\n\t\tPSOIS as string,\n\t\tPSON1 as string,\n\t\tPSON2 as string,\n\t\tPSON3 as string,\n\t\tPSOVN as string,\n\t\tPSOTL as string,\n\t\tPSOHS as string,\n\t\tPSOST as string,\n\t\tPSOO1 as string,\n\t\tPSOO2 as string,\n\t\tPSOO3 as string,\n\t\tPSOO4 as string,\n\t\tPSOO5 as string,\n\t\tJ_1IEXCD as string,\n\t\tJ_1IEXRN as string,\n\t\tJ_1IEXRG as string,\n\t\tJ_1IEXDI as string,\n\t\tJ_1IEXCO as string,\n\t\tJ_1ICSTNO as string,\n\t\tJ_1ILSTNO as string,\n\t\tJ_1IPANNO as string,\n\t\tJ_1IEXCICU as string,\n\t\tAEDAT as string,\n\t\tUSNAM as string,\n\t\tJ_1ISERN as string,\n\t\tJ_1IPANREF as string,\n\t\tJ_3GETYP as string,\n\t\tJ_3GREFTYP as string,\n\t\tPSPNR as string,\n\t\tCOAUFNR as string,\n\t\tJ_3GAGEXT as string,\n\t\tJ_3GAGINT as string,\n\t\tJ_3GAGDUMI as string,\n\t\tJ_3GAGSTDI as string,\n\t\tLGORT as string,\n\t\tKOKRS as string,\n\t\tKOSTL as string,\n\t\tJ_3GABGLG as string,\n\t\tJ_3GABGVG as string,\n\t\tJ_3GABRART as string,\n\t\tJ_3GSTDMON as decimal(38,18),\n\t\tJ_3GSTDTAG as decimal(38,18),\n\t\tJ_3GTAGMON as decimal(38,18),\n\t\tJ_3GZUGTAG as string,\n\t\tJ_3GMASCHB as string,\n\t\tJ_3GMEINSA as string,\n\t\tJ_3GKEINSA as string,\n\t\tJ_3GBLSPER as string,\n\t\tJ_3GKLEIVO as string,\n\t\tJ_3GCALID as string,\n\t\tJ_3GVMONAT as string,\n\t\tJ_3GABRKEN as string,\n\t\tJ_3GLABRECH as string,\n\t\tJ_3GAABRECH as string,\n\t\tJ_3GZUTVHLG as string,\n\t\tJ_3GNEGMEN as string,\n\t\tJ_3GFRISTLO as string,\n\t\tJ_3GEMINBE as string,\n\t\tJ_3GFMGUE as string,\n\t\tJ_3GZUSCHUE as string,\n\t\tJ_3GSCHPRS as string,\n\t\tJ_3GINVSTA as string,\n\t\t{/SAPCEM/DBER} as string,\n\t\t{/SAPCEM/KVMEQ} as string,\n\t\tCREATED_ON as timestamp,\n\t\tSOURCE as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT * FROM STAGE.KNA1',\n\tformat: 'query') ~> sourceStageKNA1\nsourceStageKNA1 select(mapColumn(\n\t\tMANDT,\n\t\tKUNNR,\n\t\tANRED,\n\t\tNAME1,\n\t\tMCOD1,\n\t\tMCOD3,\n\t\tTELF1,\n\t\tLAND1,\n\t\tSTRAS,\n\t\tADRNR,\n\t\tORT01,\n\t\tORT02,\n\t\tPSTLZ,\n\t\tREGIO,\n\t\tCREATED_ON,\n\t\tSOURCE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> selectCol\nselectCol derive(MANDT = toInteger(MANDT)) ~> changeDatatype\nchangeDatatype derive(HASHKEY_BK = md5('_',MANDT,'_',KUNNR,'_'),\n\t\tHASHKEY_DATA = md5('_',ANRED,'_',NAME1,'_',MCOD1,'_',MCOD3,'_',TELF1,'_',LAND1,'_',STRAS,'_',ADRNR,'_',ORT01,'_',ORT02,'_',PSTLZ,'_',REGIO,'_'),\n\t\tCREATED_ON = currentTimestamp(),\n\t\tSOURCE = 'asapSql.STAGE.KNA1') ~> createHash\ncreateHash select(mapColumn(\n\t\tMANDT,\n\t\tKUNNR,\n\t\tANRED,\n\t\tADRNR,\n\t\tNAME1,\n\t\tMCOD1,\n\t\tMCOD3,\n\t\tTELF1,\n\t\tLAND1,\n\t\tSTRAS,\n\t\tPSTLZ,\n\t\tORT01,\n\t\tORT02,\n\t\tREGIO,\n\t\tHASHKEY_BK,\n\t\tHASHKEY_DATA,\n\t\tCREATED_ON,\n\t\tSOURCE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectColumnOrder\nSelectColumnOrder aggregate(groupBy(MANDT,\n\t\tKUNNR),\n\teach(match(name!='MANDT'&&name!='KUNNR'), $$ = first($$))) ~> distictRows\ndistictRows sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tpreSQLs:['TRUNCATE TABLE CLEANSE.KUNDE'],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> stageCleanseKunde"
		}
	}
}